<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Settings - Uloom-e-Shariyah</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" />
    <link rel="stylesheet" href="auth-style.css">
    <style>
        /* --- Dark Mode Variables --- */
        :root {
            --bg-color: #f4f4f4;
            --card-bg: #ffffff;
            --text-color: #2c3e50;
            --sub-text: #888;
            --border-color: #eee;
            --btn-ghost: #f1f1f1;
            --btn-ghost-text: #333;
        }

        [data-theme="dark"] {
            --bg-color: #121212;
            --card-bg: #1e1e1e;
            --text-color: #e0e0e0;
            --sub-text: #aaa;
            --border-color: #333;
            --btn-ghost: #2d2d2d;
            --btn-ghost-text: #eee;
        }

        body { 
            background-color: var(--bg-color); 
            color: var(--text-color); 
            transition: 0.3s; 
            margin: 0;
            font-family: 'Poppins', sans-serif;
        }

        .settings-container { max-width: 600px !important; margin: 20px auto; text-align: left; }
        
        .auth-box {
            background: var(--card-bg) !important;
            border: 1px solid var(--border-color);
            transition: 0.3s;
        }

        .setting-item {
            background: var(--card-bg); 
            padding: 15px; 
            border-radius: 10px;
            margin-bottom: 15px; 
            border: 1px solid var(--border-color);
            display: flex; 
            align-items: center; 
            justify-content: space-between;
            gap: 15px;
            transition: 0.3s;
        }

        .setting-info { flex: 1; }

        .setting-info h4 { margin: 0; font-size: 15px; color: var(--text-color); }
        .setting-info p { margin: 2px 0 0; font-size: 12px; color: var(--sub-text); }
        
        .level-chip {
            background: #d4af37; 
            color: white; 
            padding: 6px 15px;
            border-radius: 15px; 
            font-size: 13px; 
            font-weight: 600;
            white-space: nowrap;
            display: inline-block;
        }

        .btn-link { 
            color: #3498db; 
            cursor: pointer; 
            font-weight: 600; 
            font-size: 14px; 
            text-decoration: underline;
            white-space: nowrap;
        }

        .auth-btn-ghost {
            background: var(--btn-ghost);
            color: var(--btn-ghost-text);
            margin-top: 10px;
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
        }

        /* Floating Theme Switch */
        .theme-switch {
            position: fixed; bottom: 25px; right: 25px;
            background: none; color: var(--text-color); width: 50px; height: 50px;
            border-radius: 50%; display: flex; align-items: center; justify-content: center;
            cursor: pointer; box-shadow: 0 4px 15px rgba(0,0,0,0.2); z-index: 2000; border: none;
        }

        hr { border: 0; border-top: 1px solid var(--border-color); margin: 20px 0; }
    </style>
</head>
<body>

    <div class="auth-container">
        <div class="auth-box settings-container">
            <h2 style="color: var(--text-color);">Settings</h2>
            <p class="subtitle" style="text-align: left; color: var(--sub-text);">Manage your account & preferences</p>

            <div id="adminSection"></div>
            <div class="setting-item">
                <div class="setting-info">
                    <h4>Current Academic Level</h4>
                    <p>Your selected standard.</p>
                </div>
                <div class="level-chip" id="userLevelChip">Level 1</div>
            </div>

            <div class="setting-item">
                <div class="setting-info">
                    <h4>Personal Information</h4>
                    <p id="userEmailDisplay" style="word-break: break-all;">email@example.com</p>
                </div>
                <span class="material-symbols-outlined" style="color: var(--sub-text);">person</span>
            </div>

            <div class="setting-item">
                <div class="setting-info">
                    <h4>Security & Password</h4>
                    <p>Send a reset link to email.</p>
                </div>
                <div class="btn-link" onclick="sendResetEmail()">Reset Password</div>
            </div>

            <div class="setting-item">
                <div class="setting-info">
                    <h4>Contact Support</h4>
                    <p>Facing any access issues?</p>
                </div>
                <div class="btn-link" onclick="window.location.href='mailto:abdullah.143.m.h@gmail.com'">Email Us</div>
            </div>

            <hr>
            <button class="auth-btn" onclick="window.location.href='profile.html'">Back to Profile</button>
            <button class="auth-btn-ghost" onclick="window.location.href='index.html'">Go to Home</button>
        </div>
    </div>

    <button class="theme-switch" id="themeToggle">
        <span class="material-symbols-outlined" id="themeIcon">dark_mode</span>
    </button>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import { getAuth, sendPasswordResetEmail } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
  import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

  const firebaseConfig = { 
    apiKey: "AIzaSyB_MCKP6SPKloZpf_pHZBzy2vvkiJ3B7gk",
    authDomain: "uloom-e-shariah.firebaseapp.com",
    projectId: "uloom-e-shariah",
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);

  // --- THEME LOGIC ---
  const themeToggle = document.getElementById('themeToggle');
  const themeIcon = document.getElementById('themeIcon');

  const applyTheme = (theme) => {
      document.documentElement.setAttribute('data-theme', theme);
      themeIcon.innerText = theme === 'dark' ? 'light_mode' : 'dark_mode';
      localStorage.setItem('theme', theme);
  };

  themeToggle.addEventListener('click', () => {
      const isDark = document.documentElement.getAttribute('data-theme') === 'dark';
      applyTheme(isDark ? 'light' : 'dark');
  });
  applyTheme(localStorage.getItem('theme') || 'light');

  // --- USER DATA LOGIC ---
  const loggedInUser = JSON.parse(localStorage.getItem('loggedInUser'));

  if (!loggedInUser) {
      window.location.replace("login.html");
  } else {
      document.getElementById('userLevelChip').textContent = "Level " + (loggedInUser.level || 1);
      document.getElementById('userEmailDisplay').textContent = loggedInUser.email;

      async function checkRole() {
          const userDoc = await getDoc(doc(db, "users", loggedInUser.uid));
          if (userDoc.exists() && userDoc.data().role === "admin") {
              const adminSection = document.getElementById('adminSection');
              adminSection.innerHTML = `
                  <div class="setting-item" style="border-left: 4px solid #27ae60;">
                      <div class="setting-info">
                          <h4>Admin Control</h4>
                          <p>Manage student levels</p>
                      </div>
                      <div class="btn-link" onclick="window.location.href='admin-panel.html'">Open Panel</div>
                  </div>
              `;
          }
      }
      checkRole();
  }

  window.sendResetEmail = () => {
      sendPasswordResetEmail(auth, loggedInUser.email)
        .then(() => alert("Alhamdulillah! The reset link has been sent to your email."))
        .catch((error) => alert("Error: " + error.message));
  };
</script>

</body>
</html>
